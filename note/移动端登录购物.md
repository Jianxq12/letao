# 添加购物车功能

## 尺码选择功能

+ 给所有的尺码注册点击事件
+ 给点击的尺码添加`now`这个类，排他

## 添加购物车功能

+ 给按钮注册点击事件
+ 获取参数：`productId`，`num`，`size`
+ 发送ajax
  + 如果返回`data.error === 400`，需要跳转到登录页面，并且将当前页的地址发动到登录页

# 登录功能

## 登录静态页

+ 使用mui的`输入表单组件`
+ 使用`mui-input-password`类添加查看密码功能
+ 增加注册按钮

## 登录页面逻辑

根据登录的来源不同，登录成功后跳转的页面也不一样（画图解释）

+ 如果用户直接访问登录页面，登录成功后默认跳到用户中心页面。
+ 如果用户是从别的需要登录的页面拦截过来的（比如：购物车页面）,用户登录完成后需要跳转回原来的页面。



在本系统中，有很多接口是需要登录之后才能调用的接口，比如添加购物车。如果在没有调用的情况下，接口会返回`{"error":400,"msg":"未登录"}`的错误。

## 登录页功能实现

+ 阻止点击事件
+ 阻止默认表单提交


+ 获取用户名和密码
+ 判断用户名和密码
+ 发送ajax请求
  + 获取参数，如果有`retUrl`，需要跳转回原来的页面
  + 如果没有retUrl，跳转到`user.html`页面





# 用户中心

## 静态页面

+ mui`list 列表`的使用

## 动态渲染

+ 发送ajax，请求当前用户信息
+ 如果没有登录，跳转到登录页面
+ 如果登录了，使用模版引擎渲染数据



## 退出登录功能

+ 发送ajax请求
+ 退出到登录页面

# 购物车页面

## 静态页面

+ 订单总金额
+ 使用mui的`list`组件

## 动态渲染

+ 初始化购物车数据
+ 下拉刷新功能

初始化下拉刷新

```javascript
mui.init({
  	container:".mui-scroll-wrapper",
    pullRefresh:{
        down:{
            auto:true,//页面加载时，自动刷新一次
          	callback:function(){
                //当下拉刷新时，会触发这个回调函数
              	//需要在这个回调函数中，调用ajax获取数据，渲染数据
              	//在渲染数据完成之后，需要把下拉刷新给关闭.
              	//获取下拉刷新的实例
				var obj =mui(".mui-scroll-wrapper").pullRefresh();
            	obj.endPulldownToRefresh();//结束下拉刷新
              	obj.pulldownLoading();//让下拉刷新一次。这个方法是在，数据发生了改变的时候，重新下拉一次，比如修改了数据，删除了数据。
              
            }
        },
      	up:{
            
        }
    }
});
```



```
mui(".mui-scroll-wrapper").pullRefresh().endPulldownToRefresh();//结束刷新
mui(".mui-scroll-wrapper").pullRefresh().pulldownLoading();//重新下拉刷新
```

+ 计算订单总金额

+ 删除购物车中的商品

+ 编辑购物车中的商品

+ 修改购物车中的商品




# 注册功能

+ 获取验证码
+ 用户注册